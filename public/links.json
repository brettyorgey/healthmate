const LINKS_CACHE = { data: null, ts: 0 };

async function loadLinks(req) {
  const now = Date.now();
  // cache for 2 minutes
  if (LINKS_CACHE.data && (now - LINKS_CACHE.ts) < 120000) return LINKS_CACHE.data;
  try {
    const res = await fetchWithTimeout(`${baseUrlFromReq(req)}/links.json`, { cache: 'no-store' }, 4000);
    if (!res.ok) return LINKS_CACHE.data || [];
    const data = await res.json();
    LINKS_CACHE.data = Array.isArray(data) ? data : [];
    LINKS_CACHE.ts = now;
    return LINKS_CACHE.data;
  } catch {
    // fail-open: don’t block the response if links.json is slow
    return LINKS_CACHE.data || [];
  }
}

[
  {
    "id": "healthdirect-concussion",
    "title": "Healthdirect: Concussion",
    "url": "https://www.healthdirect.gov.au/concussion",
    "domain": "healthdirect.gov.au",
    "category": ["Psychological","Brain-Health"],
    "audience": ["player","partner","carer","official"],
    "region": "AU",
    "keywords": ["head knocks","post-concussion","concussion"]
  },
  {
    "id": "healthdirect-memory-loss",
    "title": "Healthdirect: Memory Loss",
    "url": "https://www.healthdirect.gov.au/memory-disorders",
    "domain": "healthdirect.gov.au",
    "category": ["Psychological","Brain-Health","Mental Health","Wellbeing"],
    "audience": ["player","partner","carer","official"],
    "region": "AU",
    "keywords": ["memory loss","forgetting","memory problems"]
  },
  {
    "id": "healthdirect-headaches",
    "title": "Healthdirect: Headaches",
    "url": "https://www.healthdirect.gov.au/headaches",
    "domain": "healthdirect.gov.au",
    "category": ["Psychological","Brain-Health","Wellbeing"],
    "audience": ["player","partner","carer","official"],
    "region": "AU",
    "keywords": ["headache","migraine","concussion"]
  },
  {
    "id": "healthdirect-knee-pain",
    "title": "Healthdirect: Knee pain",
    "url": "https://www.healthdirect.gov.au/knee-pain",
    "domain": "healthdirect.gov.au",
    "category": ["Physical","Wellbeing"],
    "audience": ["player","partner","carer","official"],
    "region": "AU"
  },
  {
    "id": "healthdirect-loneliness-isolation",
    "title": "Healthdirect: Loneliness and isolation",
    "url": "https://www.healthdirect.gov.au/loneliness-isolation-mental-health",
    "domain": "healthdirect.gov.au",
    "category": ["Psychological","Mental Health","Wellbeing"],
    "audience": ["player","partner","carer","official"],
    "region": "AU"
  },
  {
    "id": "healthdirect-atsi-wellbeing",
    "title": "Healthdirect: Aboriginal and Torres Strait Islander health services",
    "url": "https://www.healthdirect.gov.au/aboriginal-and-torres-strait-islander-health-services",
    "domain": "healthdirect.gov.au",
    "category": ["Psychological","Mental Health","Wellbeing"],
    "audience": ["player","partner","carer","official"],
    "region": "AU",
    "keywords": ["First Nations","Indigenous","ATSI","SEWB"]
  },
  {
    "id": "mensshed-home",
    "title": "Australian Men’s Shed Association",
    "url": "https://mensshed.org/",
    "domain": "mensshed.org",
    "category": ["Psychological","Community","Wellbeing"],
    "audience": ["player","partner","carer","official"],
    "region": "AU",
    "keywords": ["connection","community","men's shed"]
  },
  {
    "id": "beyondblue-home",
    "title": "Beyond Blue",
    "url": "https://www.beyondblue.org.au/",
    "domain": "beyondblue.org.au",
    "category": ["Psychological","Mental Health","Wellbeing"],
    "audience": ["player","partner","carer","official"],
    "region": "AU"
  },
  {
    "id": "cisa-about-concussion",
    "title": "Concussion in Sport Australia: About concussion",
    "url": "https://www.concussioninsport.gov.au/about-concussion",
    "domain": "concussioninsport.gov.au",
    "category": ["Psychological","Brain-Health"],
    "audience": ["player","partner","carer","official"],
    "region": "AU",
    "keywords": ["sport concussion","CISA","return to play"]
  },
  {
    "id": "dementia-cte-overview",
    "title": "Dementia Australia: CTE — overview & resources",
    "url": "https://www.dementia.org.au/search?keys=CTE",
    "domain": "dementia.org.au",
    "category": ["Psychological","Brain-Health"],
    "audience": ["All"],
    "region": "AU",
    "keywords": ["CTE","traumatic brain injury","chronic traumatic encephalopathy"]
  },
  {
    "id": "fifthqtr-home",
    "title": "FifthQtr: Athlete care resources",
    "url": "https://www.fifthqtr.org.au/",
    "domain": "fifthqtr.org.au",
    "category": ["All"],
    "audience": ["All"],
    "region": "AU",
    "keywords": ["FifthQtr","alumni","support"]
  },
  {
    "id": "naccho-acchos",
    "title": "NACCHO: Aboriginal Community Controlled Health Organisations",
    "url": "https://www.naccho.org.au/aboriginal-community-controlled-health/",
    "domain": "naccho.org.au",
    "category": ["Community","Health Services"],
    "audience": ["player","partner","carer","official"],
    "region": "AU",
    "keywords": ["ACCHO","First Nations","Indigenous"]
  },
    {
    "id": "prideinsport-lgbtq+",
    "title": "Pridein Sport: Explore LGBTQ+ sports clubs across Australia",
    "url": "https://prideinsport.com.au/resources-and-initiatives/lgbtq-sports-club-directory/",
    "domain": "prideinsport.com.au",
    "category": ["Identity","Sexuality, Gender & Inclusion in Sport"],
    "audience": ["player","partner","carer","official"],
    "region": "AU",
    "keywords": ["LGBTQ+","Inclusion","Sexuality","Diversity"]
  }
]
