<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FifthQtr Healthmate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --card-bg: #ffffff;
      --page-bg: #f7f9fc;
      --text: #0f172a;
      --muted: #4b5563;
      --brand: #0ea5e9;
    }
    body {
      margin: 0;
      background: var(--page-bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    /* 70% width container */
    .wrap {
      width: 70%;
      max-width: 1000px;
      min-width: 320px;
      margin: 24px auto;
      padding: 0 16px;
    }
    .hero {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 14px rgba(15,23,42,0.08);
      margin-bottom: 16px;
    }
    .hero h1 {
      margin: 0 0 8px 0;
      font-size: 28px;
      line-height: 1.2;
    }
    .hero p {
      margin: 6px 0 0 0;
      color: var(--muted);
    }
    /* Starter prompts stacked */
    .starters {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 12px 0 16px 0;
    }
    .starter-btn {
      display: block;
      text-align: left;
      border: 1px solid #e5e7eb;
      background: #fff;
      border-radius: 10px;
      padding: 10px 12px;
      cursor: pointer;
      font-size: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .starter-btn:hover { background: #f9fafb; }
    /* Chat area */
    .chat {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 4px 14px rgba(15,23,42,0.08);
      min-height: 280px;
    }
    .msg { white-space: pre-wrap; margin: 0 0 14px 0; }
    .msg.user { background:#eff6ff; padding:10px 12px; border-radius:10px; }
    .msg.assistant { background:#f8fafc; padding:10px 12px; border-radius:10px; }
    /* Clear headings inside answers */
    .msg.assistant h2, .msg.assistant h3 {
      margin: 10px 0 6px;
      padding: 0;
      font-size: 18px;
      line-height: 1.25;
      border-left: 4px solid var(--brand);
      padding-left: 8px;
    }
    .sources {
      margin-top: 16px;
      padding: 12px;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      background: #f9fafb;
      font-size: 14px;
      line-height: 1.5;
    }
    .sources strong {
      display: block;
      margin-bottom: 6px;
      font-size: 15px;
      color: var(--text);
    }
    .sources ul {
      margin: 0;
      padding-left: 18px;
    }
    .sources li {
      margin-bottom: 4px;
    }
    .sources a {
      color: var(--brand);
      font-weight: 500;
      text-decoration: underline;
    }
    .sources a:hover {
      text-decoration: none;

    .src-quote {
      margin-top: 4px;
      padding-left: 10px;
      border-left: 3px solid #e5e7eb;
      color: #475569;        /* slate-600 */
      font-size: 13px;
      font-style: italic;
      line-height: 1.5;
      white-space: pre-wrap; /* preserve line breaks */
    }
    input[type="text"] {
      flex:1; padding:12px; border-radius:10px; border:1px solid #e5e7eb;
    }
    button.send {
      padding:12px 16px;
      border-radius:10px;
      border:0;
      background: var(--brand);
      color:#fff;
      cursor:pointer;
    }
    button.send[disabled] { opacity: 0.6; cursor: not-allowed; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <h1>Welcome — we’re here to support past players & families.</h1>
      <p>Information only — not a medical diagnosis. Please see your GP for advice. In an emergency call 000.</p>
    </div>

    <!-- Starter prompts stacked -->
    <div class="starters">
      <button class="starter-btn" onclick="sendMsg('My partner has been out of football for 15 years and is forgetting tasks. What should we do and who can help in Australia?')">Memory & thinking changes after years out of footy</button>
      <button class="starter-btn" onclick="sendMsg('I’m a past player and feel low most days. What’s a sensible first step and where can I talk to someone privately?')">Feeling low / first steps & helplines</button>
      <button class="starter-btn" onclick="sendMsg('I get headaches and light sensitivity after old knocks. What should I do now and how do I track symptoms?')">Headaches & light sensitivity</button>
      <button class="starter-btn" onclick="sendMsg('As a family member, how can I support a past player who is getting forgetful without causing conflict?')">Family support without conflict</button>
      <button class="starter-btn" onclick="sendMsg('When should a past player see a GP vs. a specialist for cognitive concerns, and how to prepare for the appointment?')">GP vs specialist & appointment prep</button>
    </div>

    <div class="chat" id="chat"></div>

    <div class="inputRow">
      <input id="msg" type="text" placeholder="Type your question…" />
      <button class="send" id="sendBtn" onclick="sendMsg()">Send</button>
    </div>
  </div>

  <script>
    // Markdown helper
    function mdToHtml(md) {
      if (!md) return '';
      let s = md;
      s = s.replace(/^###\s+(.*)$/gm, '<h3>$1</h3>');
      s = s.replace(/^##\s+(.*)$/gm, '<h2>$1</h2>');
      s = s.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      s = s.replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');
      s = s.replace(/\n{2,}/g, '</p><p>').replace(/\n/g, '<br/>');
      return '<p>'+s+'</p>';
    }

    function addMsg(role, text, sources) {
      const chat = document.getElementById('chat');
      const div = document.createElement('div');
      div.className = 'msg ' + role;
      if (role === 'assistant') {
        div.innerHTML = mdToHtml(text || '');
        if (Array.isArray(sources) && sources.length) {
          const src = document.createElement('div');
          src.className = 'sources';
          let html = '<strong>Sources</strong><ul>';
          for (const s of sources) {
            const href = `/api/file?file_id=${encodeURIComponent(s.file_id)}`;
            html += `<li><a href="${href}" target="_blank" rel="noopener">${s.filename || s.file_id}</a></li>`;
          }
          html += '</ul>';
          src.innerHTML = html;
          div.appendChild(src);
        }
      } else {
        div.textContent = text;
      }
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    async function sendMsg(txt) {
      const inp = document.getElementById('msg');
      const content = (txt || inp.value || '').trim();
      if (!content) return;
      addMsg('user', content);
      inp.value = '';
      document.getElementById('sendBtn').disabled = true;
      try {
        const r = await fetch('/api/mascot', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ message: content })
        });
        const data = await r.json().catch(()=>({}));
        if (!r.ok) {
          const detail = typeof data?.detail === 'string' ? ` (${data.detail})` : '';
          addMsg('assistant', 'Sorry — server error' + detail);
        } else {
          addMsg('assistant', data.output || 'No response', data.sources);
        }
      } catch (e) {
        addMsg('assistant', 'Sorry — network error.');
      } finally {
        document.getElementById('sendBtn').disabled = false;
      }
    }
  </script>
</body>
</html>
